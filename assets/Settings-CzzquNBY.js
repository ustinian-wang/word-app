import{V as f}from"./vendor-C-Ryi81X.js";import{n as c,k as b,o as _,y as C,p as y,f as x,m as $}from"./index-BR9XZDJE.js";import{w as h}from"./WordRecordDB-ZKtcZKYU.js";import{w}from"./WordReviewDB-Dwf42sz8.js";import{$ as r}from"./toast-Bak5CmX6.js";import"./utils-DttJ4vl2.js";const N={name:"WaModal",props:{visible:Boolean,title:String,content:String,confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},width:{type:String,default:"260px"}},methods:{handleConfirm(){this.$emit("confirm")},onCancel(){this.$emit("update:visible",!1)}}};var D=function(){var e=this,a=e._self._c;return a("transition",{attrs:{name:"modal-fade"}},[e.visible?a("div",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-overlay",expression:"'wa-modal-overlay'"}],staticClass:"wa-modal-overlay",on:{click:function(s){return s.target!==s.currentTarget?null:e.$emit("update:visible",!1)}}},[a("div",{staticClass:"wa-modal",style:{width:e.width}},[e.title?a("div",{staticClass:"wa-modal-header"},[e._v(" "+e._s(e.title)+" "),a("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-close",expression:"'wa-modal-close'"}],staticClass:"wa-modal-close",on:{click:function(s){return e.$emit("update:visible",!1)}}},[e._v(" × ")])]):e._e(),a("div",{staticClass:"wa-modal-body"},[e._t("default")],2),a("div",{staticClass:"wa-modal-footer"},[a("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-cancel",expression:"'wa-modal-cancel'"}],staticClass:"wa-button-cancel",on:{click:function(s){return e.$emit("update:visible",!1)}}},[e._v(" 取消 ")]),a("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-confirm",expression:"'wa-modal-confirm'"}],staticClass:"wa-button-confirm",on:{click:e.handleConfirm}},[e._v(" 确认 ")])])])]):e._e()])},S=[],k=c(N,D,S,!1,null,"90bdb423");const g=k.exports;let i=null;function R(t){return B({content:t,confirmText:"确认",cancelText:"取消"})}function B({title:t="",content:e="",confirmText:a="确认",cancelText:s="取消"}={}){return new Promise(o=>{const u=f.extend(g);i=new u({propsData:{visible:!0,title:t,content:e,confirmText:a,cancelText:s}}),i.$mount(),document.body.appendChild(i.$el);const p=()=>{i&&(i.$destroy(),i.$el&&i.$el.parentNode&&i.$el.parentNode.removeChild(i.$el),i=null)};i.$on("confirm",()=>{p(),o(!0)}),i.$on("cancel",()=>{p(),o(!1)})})}async function I(){try{if(await R("确定要清理缓存吗？"))return;if(localStorage.clear(),sessionStorage.clear(),(await window.indexedDB.databases()).forEach(e=>{e.name&&window.indexedDB.deleteDatabase(e.name)}),"caches"in window){const e=await caches.keys();await Promise.all(e.map(a=>caches.delete(a)))}window.word_cache&&(window.word_cache={}),this.$message.success("缓存清理成功，页面将在3秒后刷新"),await b(300)}catch(t){console.error("清理缓存失败:",t),this.$message.error("清理缓存失败，请重试")}finally{window.location.reload(!0)}}const z={name:"WaInputNumber",props:{value:{type:[Number,String],default:0},min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data(){return{currValue:this.value||0}},watch:{value(t){this.currValue=t}},methods:{onInput(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[input]",e),this.$emit("input",e)},onChange(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[change]",e),this.$emit("change",e)},increment(){if(this.disabled)return;let t=this.value+this.step;t>this.max&&(t=this.max),console.log("[increment]",t),this.$emit("input",t),this.$emit("change",t)},decrement(){if(this.disabled)return;let t=this.value-this.step;t<this.min&&(t=this.min),console.log("[decrement]",t),this.$emit("input",t),this.$emit("change",t)},onBlur(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[blur]",e),this.$emit("input",e),this.$emit("change",e)}}};var M=function(){var e=this,a=e._self._c;return a("div",{staticClass:"wa-input-number",class:{"wa-input-number--disabled":e.disabled}},[a("button",{staticClass:"wa-btn wa-btn-minus",attrs:{disabled:e.disabled||e.value<=e.min},on:{click:e.decrement}},[e._v(" - ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.currValue,expression:"currValue"}],staticClass:"wa-input",attrs:{min:e.min,max:e.max,step:e.step,disabled:e.disabled},domProps:{value:e.currValue},on:{change:e.onChange,blur:e.onBlur,input:function(s){s.target.composing||(e.currValue=s.target.value)}}}),a("button",{staticClass:"wa-btn wa-btn-plus",attrs:{disabled:e.disabled||e.value>=e.max},on:{click:e.increment}},[e._v(" + ")])])},T=[],V=c(z,M,T,!1,null,"9ddaa594");const A=V.exports,P={name:"WaSwitch",props:{modelValue:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onChange(t){const e=t.target.checked;this.$emit("update:modelValue",e),this.$emit("input",e),this.$emit("change",e)}}};var W=function(){var e=this,a=e._self._c;return a("label",{staticClass:"wa-switch",class:{"wa-switch--disabled":e.disabled}},[a("input",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-input",expression:"'wa-switch-input'"}],attrs:{type:"checkbox",disabled:e.disabled},domProps:{checked:e.modelValue},on:{change:e.onChange}}),a("span",{staticClass:"wa-slider"})])},F=[],G=c(P,W,F,!1,null,"6d5ee8b6");const E=G.exports;function d(t=""){return{success:!0,msg:t,rt:0}}function l(t=""){return{success:!1,msg:t,rt:0}}const O={name:"CopyModal",props:{visible:Boolean,title:String,content:String},methods:{onCopy(){this.$refs.copyTextarea.focus(),this.$refs.copyTextarea.select();try{document.execCommand("copy")?(r.success("复制成功"),this.$emit("copied")):r.error("复制失败，请手动复制")}catch{r.error("复制失败，请手动复制")}},onCancel(){this.$emit("cancel")}}};var q=function(){var e=this,a=e._self._c;return e.visible?a("div",{directives:[{name:"test",rawName:"v-test",value:"copy-modal-mask",expression:"'copy-modal-mask'"}],staticClass:"copy-modal-mask",on:{click:function(s){return s.target!==s.currentTarget?null:e.onCancel.apply(null,arguments)}}},[a("div",{staticClass:"copy-modal"},[e.title?a("div",{staticClass:"copy-modal-title"},[e._v(e._s(e.title))]):e._e(),a("div",{staticClass:"copy-modal-content"},[a("textarea",{ref:"copyTextarea",attrs:{readonly:""},domProps:{value:e.content}})]),a("div",{staticClass:"copy-modal-actions"},[a("button",{directives:[{name:"test",rawName:"v-test",value:"cancel",expression:"'cancel'"}],staticClass:"wa-btn wa-btn-cancel",on:{click:e.onCancel}},[e._v(" 关闭 ")]),a("button",{directives:[{name:"test",rawName:"v-test",value:"confirm",expression:"'confirm'"}],staticClass:"wa-btn wa-btn-confirm",on:{click:e.onCopy}},[e._v(" 复制 ")])])])]):e._e()},J=[],j=c(O,q,J,!1,null,"13e40a43");const H=j.exports;let n=null;function K({title:t="复制内容",content:e=""}={}){return new Promise(a=>{const s=f.extend(H);let o={visible:!0,title:t,content:e};n=new s({propsData:o}),n.$mount(),document.body.appendChild(n.$el);const u=()=>{o.visible=!1,n&&(n.$destroy(),n.$el&&n.$el.parentNode&&n.$el.parentNode.removeChild(n.$el),n=null)};n.$on("copied",()=>{u(),a(!0)}),n.$on("cancel",()=>{u(),a(!1)})})}function L(t){return navigator.clipboard?navigator.clipboard.writeText(t).catch(()=>v(t)).then(()=>d("复制成功")):v(t)}function v(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.focus(),e.select();const a=document.execCommand("copy");return document.body.removeChild(e),a?d("复制成功"):l("复制失败，请手动长按文本进行复制")}async function Q(){const t=await h.getAllRecords(),e=await w.getAllWords();let a={wordRecords:t,wordReviews:e};if(console.log(a),m(a))return l("没有需要导出的学习记录。");const s=JSON.stringify(a);let o=await L(s);if(o.success)return r.success(o.msg);K({title:"全选复制内容",content:s})}function m(t){let{wordRecords:e=[],wordReviews:a=[]}=t;return console.log(e,a),e.length===0&&a.length===0}async function U(t){if(console.log("[importAppData2DB] 111",t),_(t)){if(t=t.trim(),console.log("[importAppData2DB] 222",t),t==="")return l("粘贴内容不能为空！");C(t)&&(t=JSON.parse(t),console.log("[importAppData2DB] 333",t))}if(y(t)){if(console.log("[importAppData2DB] 444",t),m(t))return l("没有需要导入的学习记录。")}else return l("粘贴内容格式错误！");let{wordRecords:e=[],wordReviews:a=[]}=t;if(m(t))return l("没有需要导入的学习记录。");for(const s of e)await h.importRecord(s);for(const s of a)await w.importWord(s);return d("导入成功！")}const X={name:"Settings",components:{WaInputNumber:A,WaSwitch:E,WaModal:g},data(){return{theme:"light",showPhonetic:!0,autoPlayAudio:!1,showDictionary:!0,enableShortcuts:!0,showImportModal:!1,importData:""}},computed:{...$("setting",["groupSize","debug","debugSetup"]),...x("setting",["setGroupSize","setDebug"]),currGroupSize:{get(){return this.groupSize},set(t){console.log("[value]",t),this.setGroupSize(t)}},currDebug:{get(){return this.debug},set(t){this.setDebug(t)}}},methods:{clearSysCache:I,saveSettings(){alert("设置已保存（仅本地演示，未持久化）")},async handleExport(){Q()},async handleImport(){if(!this.importData){r.error("请输入导入内容");return}let t=await U(this.importData);t.success?(r.success("导入成功"),this.showImportModal=!1,this.importData=""):r.error(t.msg||"导入失败")},openFeedback(){window.open("https://support.qq.com/product/741648","_blank")}}};var Y=function(){var e=this,a=e._self._c;return a("div",{staticClass:"settings-page"},[a("div",{staticClass:"settings-group"},[a("div",{staticClass:"settings-title"},[e._v("通用")]),e.debugSetup?a("div",{staticClass:"setting-item"},[a("span",{staticClass:"setting-label"},[e._v("调试模式")]),a("wa-switch",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-debug",expression:"'wa-switch-debug'"}],model:{value:e.currDebug,callback:function(s){e.currDebug=s},expression:"currDebug"}})],1):e._e(),a("div",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],staticClass:"setting-item"},[a("span",{staticClass:"setting-label"},[e._v("每次学习数量")]),a("div",{staticClass:"setting-control"},[a("wa-input-number",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],attrs:{min:10,max:40,step:1},model:{value:e.currGroupSize,callback:function(s){e.currGroupSize=s},expression:"currGroupSize"}})],1)]),a("div",{directives:[{name:"test",rawName:"v-test",value:"clearCache",expression:"'clearCache'"}],staticClass:"setting-item",on:{click:e.clearSysCache}},[a("span",{staticClass:"setting-label",staticStyle:{color:"#3578e5"}},[e._v("清理缓存")])])]),a("div",{staticClass:"settings-group"},[a("div",{staticClass:"settings-title"},[e._v("数据同步")]),a("div",{staticClass:"setting-item"},[a("span",{staticClass:"setting-label"},[e._v("学习记录")]),a("div",{staticClass:"setting-actions"},[a("button",{directives:[{name:"test",rawName:"v-test",value:"export",expression:"'export'"}],staticClass:"wa-button",attrs:{type:"button"},on:{click:e.handleExport}},[e._v(" 导出 ")]),a("button",{directives:[{name:"test",rawName:"v-test",value:"import",expression:"'import'"}],staticClass:"wa-button",attrs:{type:"button"},on:{click:function(s){e.showImportModal=!0}}},[e._v(" 导入 ")])])])]),a("div",{staticClass:"settings-footer"},[e._v("更多设置即将开放…")]),a("div",{staticClass:"settings-feedback"},[a("button",{staticClass:"wa-button",attrs:{type:"button"},on:{click:e.openFeedback}},[e._v("意见反馈")])]),a("wa-modal",{attrs:{visible:e.showImportModal,title:"导入学习记录"},on:{"update:visible":function(s){e.showImportModal=s},confirm:e.handleImport}},[a("p",{staticClass:"import-description"},[e._v("请将之前导出的学习记录文本粘贴到下方文本框中。")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.importData,expression:"importData"},{name:"test",rawName:"v-test",value:"import-textarea",expression:"'import-textarea'"}],staticClass:"import-textarea",attrs:{placeholder:"请在此处粘贴学习记录..."},domProps:{value:e.importData},on:{input:function(s){s.target.composing||(e.importData=s.target.value)}}})])],1)},Z=[],ee=c(X,Y,Z,!1,null,"99f28f38");const re=ee.exports;export{re as default};
