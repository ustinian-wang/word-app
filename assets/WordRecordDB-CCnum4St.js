import{r as w}from"./request-B_2Tscip.js";const I=(t,e)=>e.some(n=>t instanceof n);let S,M;function v(){return S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function j(){return M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b=new WeakMap,y=new WeakMap,f=new WeakMap;function U(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{n(h(t.result)),a()},s=()=>{r(t.error),a()};t.addEventListener("success",i),t.addEventListener("error",s)});return f.set(e,t),e}function V(t){if(b.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{n(),a()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});b.set(t,e)}let B={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return b.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function x(t){B=t(B)}function k(t){return j().includes(t)?function(...e){return t.apply(p(this),e),h(this.request)}:function(...e){return h(t.apply(p(this),e))}}function F(t){return typeof t=="function"?k(t):(t instanceof IDBTransaction&&V(t),I(t,v())?new Proxy(t,B):t)}function h(t){if(t instanceof IDBRequest)return U(t);if(y.has(t))return y.get(t);const e=F(t);return e!==t&&(y.set(t,e),f.set(e,t)),e}const p=t=>f.get(t);function _(t,e,{blocked:n,upgrade:r,blocking:a,terminated:i}={}){const s=indexedDB.open(t,e),d=h(s);return r&&s.addEventListener("upgradeneeded",o=>{r(h(s.result),o.oldVersion,o.newVersion,h(s.transaction),o)}),n&&s.addEventListener("blocked",o=>n(o.oldVersion,o.newVersion,o)),d.then(o=>{i&&o.addEventListener("close",()=>i()),a&&o.addEventListener("versionchange",u=>a(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}const K=["get","getKey","getAll","getAllKeys","count"],Y=["put","add","delete","clear"],R=new Map;function P(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(R.get(e))return R.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=Y.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||K.includes(n)))return;const i=async function(s,...d){const o=this.transaction(s,a?"readwrite":"readonly");let u=o.store;return r&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),a&&o.done]))[0]};return R.set(e,i),i}x(t=>({...t,get:(e,n,r)=>P(e,n)||t.get(e,n,r),has:(e,n)=>!!P(e,n)||t.has(e,n)}));const G=["continue","continuePrimaryKey","advance"],W={},T=new WeakMap,L=new WeakMap,H={get(t,e){if(!G.includes(e))return t[e];let n=W[e];return n||(n=W[e]=function(...r){T.set(this,L.get(this)[e](...r))}),n}};async function*q(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,H);for(L.set(n,e),f.set(n,p(e));e;)yield n,e=await(T.get(n)||e.continue()),T.delete(n)}function N(t,e){return e===Symbol.asyncIterator&&I(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&I(t,[IDBIndex,IDBObjectStore])}x(t=>({...t,get(e,n,r){return N(e,n)?q:t.get(e,n,r)},has(e,n){return N(e,n)||t.has(e,n)}}));function J(t){return w.get("/api/wordRecord/addWordRecord",{params:t})}function Q(t){return w.get("/api/wordRecord/getLearnResByTime",{params:t})}function X(t){return w.get("/api/wordRecord/getNextLearningWords",{params:t})}function Z(t){return w.get("/api/wordRecord/getTodayReviewWords",{params:t})}const m={FAIL:0,PASS:1},g={LEARNING:0,REVIEW:1},c={WORD:"word",TIMESTAMP:"timestamp",STATUS:"status",UID:"uid",TYPE:"type"};class ${constructor(){this.dbName="wordAppRecordDB",this.storeName="wordRecords",this.version=1}async initDB(){return _(this.dbName,this.version,{upgrade(e){if(!e.objectStoreNames.contains("wordRecords")){const n=e.createObjectStore("wordRecords",{keyPath:"id",autoIncrement:!0});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("word","word",{unique:!1})}}})}async addNewRecord(e,n,r=0,a=g.LEARNING){const i={[c.WORD]:e,[c.TIMESTAMP]:Date.now(),[c.STATUS]:n,[c.UID]:r,[c.TYPE]:a};return await this.addRecord(i)}async addRecord(e){return await(await this.initDB()).add(this.storeName,e)}async getRecordsByUid(e){return await(await this.initDB()).transaction(this.storeName).store.index("uid").getAll(e)}async getRecordsByWord(e){return await(await this.initDB()).transaction(this.storeName).store.index("word").getAll(e)}async getRecordsByTimeRange(e,n){return await(await this.initDB()).transaction(this.storeName).store.index("timestamp").getAll(IDBKeyRange.bound(e,n))}async deleteRecord(e){return await(await this.initDB()).delete(this.storeName,e)}async clearAllRecords(){return await(await this.initDB()).clear(this.storeName)}async getAllRecords(){return await(await this.initDB()).getAll(this.storeName)}async updateRecord(e){return await(await this.initDB()).put(this.storeName,e)}async importRecord(e){return await this.initDB(),(await this.getRecordsByWord(e[c.WORD])).length>0?await this.updateRecord(e):await this.addRecord(e)}async generateTestData(){await this.clearAllRecords();const e=["apple","banana","orange","grape","watermelon","computer","phone","laptop","tablet","keyboard","book","pen","pencil","notebook","dictionary","student","teacher","school","university","classroom","house","building","apartment","room","kitchen"],n=new Date,r=[];for(let d=0;d<30;d++){const o=new Date(n);o.setDate(o.getDate()-d);const u=Math.floor(Math.random()*11)+5,O=e.sort(()=>Math.random()-.5).slice(0,u);for(const A of O){const E=Math.random()>.3?m.PASS:m.FAIL,l=new Date(o);if(l.setHours(Math.floor(Math.random()*12)+8),r.push({[c.WORD]:A,[c.TIMESTAMP]:l.getTime(),[c.STATUS]:E,[c.UID]:0,[c.TYPE]:g.LEARNING}),E===m.PASS){const D=new Date(l);D.setHours(D.getHours()+Math.floor(Math.random()*4)+1);const C=Math.random()>.2?m.PASS:m.FAIL;r.push({[c.WORD]:A,[c.TIMESTAMP]:D.getTime(),[c.STATUS]:C,[c.UID]:0,[c.TYPE]:g.REVIEW})}}}r.sort((d,o)=>d.timestamp-o.timestamp);const i=(await this.initDB()).transaction(this.storeName,"readwrite"),s=i.objectStore(this.storeName);for(const d of r)await s.add(d);await i.done,console.log("测试数据生成完成，共生成",r.length,"条记录")}}const ee=new $;export{g as W,Z as a,Q as b,m as c,J as d,X as g,_ as o,ee as w};
