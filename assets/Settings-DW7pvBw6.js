import{V as f}from"./vendor-C-Ryi81X.js";import{n as l,k as _,l as b,y as C,o as y,f as P,m as $}from"./index-B3iVEKOE.js";import{w as h}from"./WordRecordDB-BIDTmvIi.js";import{w as v}from"./WordReviewDB-BsMugDoC.js";import{$ as o}from"./toast-Opw-9iPT.js";import{c as x,a as N,m as S}from"./userApi-L1psPT2Y.js";import{s as D}from"./request-D-MoQ5dY.js";import"./utils-DttJ4vl2.js";const k={name:"WaModal",props:{visible:Boolean,title:String,content:String,confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},width:{type:String,default:"260px"}},methods:{handleConfirm(){this.$emit("confirm")},onCancel(){this.$emit("update:visible",!1)}}};var I=function(){var e=this,s=e._self._c;return s("transition",{attrs:{name:"modal-fade"}},[e.visible?s("div",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-overlay",expression:"'wa-modal-overlay'"}],staticClass:"wa-modal-overlay",on:{click:function(a){return a.target!==a.currentTarget?null:e.$emit("update:visible",!1)}}},[s("div",{staticClass:"wa-modal",style:{width:e.width}},[e.title?s("div",{staticClass:"wa-modal-header"},[e._v(" "+e._s(e.title)+" "),s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-close",expression:"'wa-modal-close'"}],staticClass:"wa-modal-close",on:{click:function(a){return e.$emit("update:visible",!1)}}},[e._v(" × ")])]):e._e(),s("div",{staticClass:"wa-modal-body"},[e._t("default")],2),s("div",{staticClass:"wa-modal-footer"},[s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-cancel",expression:"'wa-modal-cancel'"}],staticClass:"wa-button-cancel",on:{click:function(a){return e.$emit("update:visible",!1)}}},[e._v(" 取消 ")]),s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-confirm",expression:"'wa-modal-confirm'"}],staticClass:"wa-button-confirm",on:{click:e.handleConfirm}},[e._v(" 确认 ")])])])]):e._e()])},F=[],R=l(k,I,F,!1,null,"90bdb423");const g=R.exports;let i=null;function M(t){return B({content:t,confirmText:"确认",cancelText:"取消"})}function B({title:t="",content:e="",confirmText:s="确认",cancelText:a="取消"}={}){return new Promise(r=>{const d=f.extend(g);i=new d({propsData:{visible:!0,title:t,content:e,confirmText:s,cancelText:a}}),i.$mount(),document.body.appendChild(i.$el);const p=()=>{i&&(i.$destroy(),i.$el&&i.$el.parentNode&&i.$el.parentNode.removeChild(i.$el),i=null)};i.$on("confirm",()=>{p(),r(!0)}),i.$on("cancel",()=>{p(),r(!1)})})}async function z(){try{if(await M("确定要清理缓存吗？"))return;if(localStorage.clear(),sessionStorage.clear(),(await window.indexedDB.databases()).forEach(e=>{e.name&&window.indexedDB.deleteDatabase(e.name)}),"caches"in window){const e=await caches.keys();await Promise.all(e.map(s=>caches.delete(s)))}window.word_cache&&(window.word_cache={}),this.$message.success("缓存清理成功，页面将在3秒后刷新"),await _(300)}catch(t){console.error("清理缓存失败:",t),this.$message.error("清理缓存失败，请重试")}finally{window.location.reload(!0)}}const A={name:"WaInputNumber",props:{value:{type:[Number,String],default:0},min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data(){return{currValue:this.value||0}},watch:{value(t){this.currValue=t}},methods:{onInput(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[input]",e),this.$emit("input",e)},onChange(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[change]",e),this.$emit("change",e)},increment(){if(this.disabled)return;let t=this.value+this.step;t>this.max&&(t=this.max),console.log("[increment]",t),this.$emit("input",t),this.$emit("change",t)},decrement(){if(this.disabled)return;let t=this.value-this.step;t<this.min&&(t=this.min),console.log("[decrement]",t),this.$emit("input",t),this.$emit("change",t)},onBlur(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[blur]",e),this.$emit("input",e),this.$emit("change",e)}}};var T=function(){var e=this,s=e._self._c;return s("div",{staticClass:"wa-input-number",class:{"wa-input-number--disabled":e.disabled}},[s("button",{staticClass:"wa-btn wa-btn-minus",attrs:{disabled:e.disabled||e.value<=e.min},on:{click:e.decrement}},[e._v(" - ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.currValue,expression:"currValue"}],staticClass:"wa-input",attrs:{min:e.min,max:e.max,step:e.step,disabled:e.disabled},domProps:{value:e.currValue},on:{change:e.onChange,blur:e.onBlur,input:function(a){a.target.composing||(e.currValue=a.target.value)}}}),s("button",{staticClass:"wa-btn wa-btn-plus",attrs:{disabled:e.disabled||e.value>=e.max},on:{click:e.increment}},[e._v(" + ")])])},V=[],W=l(A,T,V,!1,null,"9ddaa594");const G=W.exports,E={name:"WaSwitch",props:{modelValue:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onChange(t){const e=t.target.checked;this.$emit("update:modelValue",e),this.$emit("input",e),this.$emit("change",e)}}};var L=function(){var e=this,s=e._self._c;return s("label",{staticClass:"wa-switch",class:{"wa-switch--disabled":e.disabled}},[s("input",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-input",expression:"'wa-switch-input'"}],attrs:{type:"checkbox",disabled:e.disabled},domProps:{checked:e.modelValue},on:{change:e.onChange}}),s("span",{staticClass:"wa-slider"})])},O=[],J=l(E,L,O,!1,null,"6d5ee8b6");const q=J.exports,U={name:"IosSettingItem",props:{label:String,danger:Boolean}};var j=function(){var e=this,s=e._self._c;return s("div",{staticClass:"ios-setting-item",class:{"ios-setting-item-danger":e.danger},on:{click:function(a){return e.$emit("click")}}},[s("span",{staticClass:"ios-setting-label"},[e._t("default",function(){return[e._v(e._s(e.label))]})],2),s("span",{staticClass:"ios-setting-arrow"},[e._v("›")])])},H=[],K=l(U,j,H,!1,null,"aab5e5eb");const Q=K.exports;function u(t=""){return{success:!0,msg:t,rt:0}}function c(t=""){return{success:!1,msg:t,rt:0}}const X={name:"CopyModal",props:{visible:Boolean,title:String,content:String},methods:{onCopy(){this.$refs.copyTextarea.focus(),this.$refs.copyTextarea.select();try{document.execCommand("copy")?(o.success("复制成功"),this.$emit("copied")):o.error("复制失败，请手动复制")}catch{o.error("复制失败，请手动复制")}},onCancel(){this.$emit("cancel")}}};var Y=function(){var e=this,s=e._self._c;return e.visible?s("div",{directives:[{name:"test",rawName:"v-test",value:"copy-modal-mask",expression:"'copy-modal-mask'"}],staticClass:"copy-modal-mask",on:{click:function(a){return a.target!==a.currentTarget?null:e.onCancel.apply(null,arguments)}}},[s("div",{staticClass:"copy-modal"},[e.title?s("div",{staticClass:"copy-modal-title"},[e._v(e._s(e.title))]):e._e(),s("div",{staticClass:"copy-modal-content"},[s("textarea",{ref:"copyTextarea",attrs:{readonly:""},domProps:{value:e.content}})]),s("div",{staticClass:"copy-modal-actions"},[s("button",{directives:[{name:"test",rawName:"v-test",value:"cancel",expression:"'cancel'"}],staticClass:"wa-btn wa-btn-cancel",on:{click:e.onCancel}},[e._v(" 关闭 ")]),s("button",{directives:[{name:"test",rawName:"v-test",value:"confirm",expression:"'confirm'"}],staticClass:"wa-btn wa-btn-confirm",on:{click:e.onCopy}},[e._v(" 复制 ")])])])]):e._e()},Z=[],ee=l(X,Y,Z,!1,null,"13e40a43");const te=ee.exports;let n=null;function se({title:t="复制内容",content:e=""}={}){return new Promise(s=>{const a=f.extend(te);let r={visible:!0,title:t,content:e};n=new a({propsData:r}),n.$mount(),document.body.appendChild(n.$el);const d=()=>{r.visible=!1,n&&(n.$destroy(),n.$el&&n.$el.parentNode&&n.$el.parentNode.removeChild(n.$el),n=null)};n.$on("copied",()=>{d(),s(!0)}),n.$on("cancel",()=>{d(),s(!1)})})}function ae(t){return navigator.clipboard?navigator.clipboard.writeText(t).catch(()=>w(t)).then(()=>u("复制成功")):w(t)}function w(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.focus(),e.select();const s=document.execCommand("copy");return document.body.removeChild(e),s?u("复制成功"):c("复制失败，请手动长按文本进行复制")}async function ie(){const t=await h.getAllRecords(),e=await v.getAllWords();let s={wordRecords:t,wordReviews:e};if(console.log(s),m(s))return c("没有需要导出的学习记录。");const a=JSON.stringify(s);let r=await ae(a);if(r.success)return o.success(r.msg);se({title:"全选复制内容",content:a})}function m(t){let{wordRecords:e=[],wordReviews:s=[]}=t;return console.log(e,s),e.length===0&&s.length===0}async function ne(t){if(console.log("[importAppData2DB] 111",t),b(t)){if(t=t.trim(),console.log("[importAppData2DB] 222",t),t==="")return c("粘贴内容不能为空！");C(t)&&(t=JSON.parse(t),console.log("[importAppData2DB] 333",t))}if(y(t)){if(console.log("[importAppData2DB] 444",t),m(t))return c("没有需要导入的学习记录。")}else return c("粘贴内容格式错误！");let{wordRecords:e=[],wordReviews:s=[]}=t;if(m(t))return c("没有需要导入的学习记录。");for(const a of e)await h.importRecord(a);for(const a of s)await v.importWord(a);return u("导入成功！")}const oe={name:"Settings",components:{WaInputNumber:G,WaSwitch:q,WaModal:g,IosSettingItem:Q},data(){return{theme:"light",showPhonetic:!0,autoPlayAudio:!1,showDictionary:!0,enableShortcuts:!0,showImportModal:!1,showChangePwdModal:!1,importData:"",meInfo:{},changePwdForm:{oldPassword:"",newPassword:"",confirmPassword:""}}},computed:{...$("setting",["groupSize","debug","debugSetup"]),...P("setting",["setGroupSize","setDebug"]),currGroupSize:{get(){return this.groupSize},set(t){console.log("[value]",t),this.setGroupSize(t)}},currDebug:{get(){return this.debug},set(t){this.setDebug(t)}},user(){var t;return((t=this.$store.state.user)==null?void 0:t.userInfo)||JSON.parse(localStorage.getItem("userInfo")||"{}")}},methods:{clearSysCache:z,saveSettings(){alert("设置已保存（仅本地演示，未持久化）")},async handleExport(){ie()},async handleImport(){if(!this.importData){o.error("请输入导入内容");return}let t=await ne(this.importData);t.success?(o.success("导入成功"),this.showImportModal=!1,this.importData=""):o.error(t.msg||"导入失败")},openFeedback(){window.open("https://support.qq.com/product/741648","_blank")},async getMe(){let t=await S();t.data.success&&(this.meInfo=t.data.data)},async handleLogout(){this.meInfo={},o.success("已退出登录"),D(null)},async handleChangePassword(){if(!this.changePwdForm.oldPassword||!this.changePwdForm.newPassword||!this.changePwdForm.confirmPassword){o.error("请填写完整信息");return}if(this.changePwdForm.newPassword!==this.changePwdForm.confirmPassword){o.error("两次输入的新密码不一致");return}const t=await N({oldPassword:this.changePwdForm.oldPassword,newPassword:this.changePwdForm.newPassword});t.data.success?(o.success("密码修改成功"),this.showChangePwdModal=!1,this.changePwdForm.oldPassword="",this.changePwdForm.newPassword="",this.changePwdForm.confirmPassword=""):o.error(t.data.msg||"密码修改失败")}},async mounted(){let t=await x();t.data.success&&t.data.data.loggedIn&&this.getMe()}};var re=function(){var e=this,s=e._self._c;return s("div",{staticClass:"settings-page"},[s("div",{staticClass:"ios-section ios-user-section"},[s("div",{staticClass:"ios-avatar-box"},[s("div",{staticClass:"user-avatar ios-avatar"},[s("span",{staticClass:"avatar-text"},[e._v(" "+e._s(e.meInfo.username?e.meInfo.username.charAt(0).toUpperCase():"?")+" ")])])]),s("div",{staticClass:"ios-user-meta"},[s("div",{staticClass:"ios-user-name"},[e._v(e._s(e.meInfo.username||"未登录"))]),e.meInfo.email?s("div",{staticClass:"ios-user-email"},[e._v(e._s(e.meInfo.email))]):e._e(),e.meInfo.username?e._e():s("div",{staticClass:"ios-login-btn-box"},[s("button",{staticClass:"ios-login-btn",on:{click:function(a){return e.$router.push("/login")}}},[e._v("去登录")])])])]),s("div",{staticClass:"settings-group"},[s("div",{staticClass:"settings-title"},[e._v("通用")]),e.debugSetup?s("div",{staticClass:"setting-item"},[s("span",{staticClass:"setting-label"},[e._v("调试模式")]),s("wa-switch",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-debug",expression:"'wa-switch-debug'"}],model:{value:e.currDebug,callback:function(a){e.currDebug=a},expression:"currDebug"}})],1):e._e(),s("div",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],staticClass:"setting-item"},[s("span",{staticClass:"setting-label"},[e._v("每次学习数量")]),s("div",{staticClass:"setting-control"},[s("wa-input-number",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],attrs:{min:10,max:40,step:1},model:{value:e.currGroupSize,callback:function(a){e.currGroupSize=a},expression:"currGroupSize"}})],1)]),s("div",{directives:[{name:"test",rawName:"v-test",value:"clearCache",expression:"'clearCache'"}],staticClass:"setting-item",on:{click:e.clearSysCache}},[s("span",{staticClass:"setting-label",staticStyle:{color:"#3578e5"}},[e._v("清理缓存")])])]),e._e(),s("div",{staticClass:"ios-section ios-setting-list ios-logout-section"},[s("div",{staticClass:"setting-item",on:{click:function(a){e.showChangePwdModal=!0}}},[s("span",{staticClass:"setting-label",staticStyle:{color:"#3578e5"}},[e._v("修改密码")])]),e.meInfo.username?s("IosSettingItem",{attrs:{label:"退出登录",danger:""},on:{click:e.handleLogout}}):e._e()],1),s("div",{staticClass:"settings-footer"},[e._v("更多设置即将开放…")]),s("div",{staticClass:"settings-feedback"},[s("button",{staticClass:"wa-button",attrs:{type:"button"},on:{click:e.openFeedback}},[e._v("意见反馈")])]),s("wa-modal",{attrs:{visible:e.showImportModal,title:"导入学习记录"},on:{"update:visible":function(a){e.showImportModal=a},confirm:e.handleImport}},[s("p",{staticClass:"import-description"},[e._v("请将之前导出的学习记录文本粘贴到下方文本框中。")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.importData,expression:"importData"},{name:"test",rawName:"v-test",value:"import-textarea",expression:"'import-textarea'"}],staticClass:"import-textarea",attrs:{placeholder:"请在此处粘贴学习记录..."},domProps:{value:e.importData},on:{input:function(a){a.target.composing||(e.importData=a.target.value)}}})]),s("wa-modal",{attrs:{visible:e.showChangePwdModal,title:"修改密码"},on:{"update:visible":function(a){e.showChangePwdModal=a},confirm:e.handleChangePassword}},[s("div",{staticClass:"change-pwd-form"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.changePwdForm.oldPassword,expression:"changePwdForm.oldPassword"}],staticClass:"auth-input",attrs:{type:"password",placeholder:"请输入旧密码"},domProps:{value:e.changePwdForm.oldPassword},on:{input:function(a){a.target.composing||e.$set(e.changePwdForm,"oldPassword",a.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.changePwdForm.newPassword,expression:"changePwdForm.newPassword"}],staticClass:"auth-input",attrs:{type:"password",placeholder:"请输入新密码"},domProps:{value:e.changePwdForm.newPassword},on:{input:function(a){a.target.composing||e.$set(e.changePwdForm,"newPassword",a.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.changePwdForm.confirmPassword,expression:"changePwdForm.confirmPassword"}],staticClass:"auth-input",attrs:{type:"password",placeholder:"请确认新密码"},domProps:{value:e.changePwdForm.confirmPassword},on:{input:function(a){a.target.composing||e.$set(e.changePwdForm,"confirmPassword",a.target.value)}}})])])],1)},ce=[],le=l(oe,re,ce,!1,null,"e806064d");const ge=le.exports;export{ge as default};
