import{n as p,r as _,R as v}from"./index-B3iVEKOE.js";import{$ as l}from"./toast-Opw-9iPT.js";import"./vendor-C-Ryi81X.js";import"./utils-DttJ4vl2.js";const x={name:"ImageTagOverlay",props:["imageUrl","products"],data(){return{imgWidth:1,imgHeight:1,activeIdx:null,popupStyle:{}}},methods:{onImgLoad(){const s=this.$refs.img;this.imgWidth=s.naturalWidth,this.imgHeight=s.naturalHeight},getBoxStyle(s){const t=s.XMin/this.imgWidth*100,e=s.YMin/this.imgHeight*100,a=(s.XMax-s.XMin)/this.imgWidth*100,i=(s.YMax-s.YMin)/this.imgHeight*100;return{position:"absolute",left:t+"%",top:e+"%",width:a+"%",height:i+"%",border:"2px solid #f00",boxSizing:"border-box",cursor:"pointer",zIndex:10}},getScaleX(){const s=this.$refs.img;return s?s.width/this.imgWidth:1},getScaleY(){const s=this.$refs.img;return s?s.height/this.imgHeight:1},showInfo(s,t){this.activeIdx=s,this.popupStyle={position:"absolute",left:t.offsetX+10+"px",top:t.offsetY+10+"px",background:"#fff",border:"1px solid #ccc",padding:"8px",zIndex:100}}}};var I=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{position:"relative",display:"inline-block"}},[e("img",{ref:"img",attrs:{src:t.imageUrl},on:{load:t.onImgLoad}}),t._l(t.products,function(a,i){return e("div",{key:i,staticClass:"tag-box",style:t.getBoxStyle(a),on:{click:function(n){return t.showInfo(i,n)}}},[e("span",{staticClass:"tag-label"},[t._v(t._s(a.Name))]),t.activeIdx===i?e("div",{staticClass:"tag-popup",style:t.popupStyle},[e("div",[e("strong",[t._v(t._s(a.Name))]),e("br"),t._v(" 分类: "+t._s(a.Parents)),e("br"),t._v(" 置信度: "+t._s(a.Confidence)+"% ")]),e("button",{on:{click:function(n){n.stopPropagation(),t.activeIdx=null}}},[t._v("关闭")])]):t._e()])})],2)},y=[],w=p(x,I,y,!1,null,"c76c7de4");const R=w.exports,C={name:"RecognitionResult",props:{imageUrl:String,products:Array},components:{ImageTagOverlay:R}};var $=function(){var t=this,e=t._self._c;return t.imageUrl&&t.products&&t.products.length?e("div",{staticClass:"card"},[e("ImageTagOverlay",{attrs:{"image-url":t.imageUrl,products:t.products}})],1):t._e()},b=[],z=p(C,$,b,!1,null,null);const U=z.exports;function k(s,t=800,e=1600,a=.8){return new Promise((i,n)=>{const o=new window.Image,g=new FileReader;g.onload=r=>{o.src=r.target.result},o.onload=()=>{let{width:r,height:c}=o;if(r<=t){i(o.src);return}const u=Math.min(t/r,e/c,1);r=r*u,c=c*u;const d=document.createElement("canvas");d.width=r,d.height=c,d.getContext("2d").drawImage(o,0,0,r,c),d.toBlob(h=>{const m=new FileReader;m.onload=f=>i(f.target.result),m.onerror=n,m.readAsDataURL(h)},"image/jpeg",a)},o.onerror=n,g.onerror=n,g.readAsDataURL(s)})}const S={name:"Recognize",components:{RecognitionResult:U},computed:{RouterDef(){return v}},data(){return{imageUrl:"",products:[]}},methods:{triggerFileInput(){this.$refs.fileInput.click()},async onFileChange(s){const t=s.target.files[0];if(!t)return;const e=Math.min(window.innerWidth,800),a=e*2,i=await k(t,e,a,.8);this.onImageUploaded(i),this.$refs.fileInput.value=""},async onImageUploaded(s){var t,e,a;this.imageUrl=s,this.products=[];try{l.loading("识别中..");const i=await _({ImageBase64:s});i.data.success?(l.success("识别成功"),((a=(e=(t=i==null?void 0:i.data)==null?void 0:t.data)==null?void 0:e.Products)==null?void 0:a.length)===0?l.error("没有识别到物体"):this.products=i.data.data.Products):l.error("识别失败")}catch{l.error("识别失败")}this.$forceUpdate()}},beforeMount(){this.$route.query.auto}};var M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"recognize-page",attrs:{id:"app"}},[e("div",{staticClass:"recognize-header"},[e("span",{staticClass:"recognize-title"},[t._v(t._s(t.RouterDef.Recognize.title))])]),e("div",{staticClass:"recognize-card-group"},[e("div",{staticClass:"recognize-card upload-card"},[e("div",{staticClass:"upload-dropzone",on:{click:t.triggerFileInput}},[e("svg",{staticClass:"upload-icon",attrs:{width:"48",height:"48",viewBox:"0 0 48 48"}},[e("g",{attrs:{fill:"none",stroke:"#3578e5","stroke-width":"2.5"}},[e("rect",{attrs:{x:"6",y:"6",width:"36",height:"36",rx:"8","stroke-dasharray":"6 4"}}),e("path",{attrs:{d:"M24 16v16m0 0l-6-6m6 6l6-6","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("div",{staticClass:"upload-text"},[t._v("点击上传图片识别")])]),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.onFileChange}})]),e("div",{staticClass:"recognize-card result-card"},[e("RecognitionResult",{attrs:{imageUrl:t.imageUrl,products:t.products}})],1)])])},F=[],H=p(S,M,F,!1,null,"1ef49dd4");const Y=H.exports;export{Y as default};
