import{i as c}from"./utils-DttJ4vl2.js";import{w as n,W as h,a as o}from"./WordRecordDB-ZKtcZKYU.js";import{n as d,f as u}from"./index-BAodwoWl.js";import"./vendor-C-Ryi81X.js";const v={name:"RecordView",data(){return{loading:!0,records:[],filteredRecords:[],chart:null,touchStartX:0,touchStartY:0,selectedRange:"7"}},computed:{...u("setting",["isDebugMode"]),hasData(){return this.filteredRecords.length>0}},methods:{formatDate(a){const t=new Date(a),e=t.getMonth()+1,s=t.getDate();return`${e}/${s}`},getDateRange(){const a=new Date;if(a.setHours(23,59,59,999),this.selectedRange==="all")return{start:new Date(0),end:a};const t=new Date;return t.setDate(a.getDate()-parseInt(this.selectedRange)),t.setHours(0,0,0,0),{start:t,end:a}},handleRangeChange(){this.filterRecords();const a=this.processData(this.filteredRecords);this.initChart(a)},filterRecords(){const{start:a,end:t}=this.getDateRange();this.filteredRecords=this.records.filter(e=>{const s=new Date(e.timestamp);return s>=a&&s<=t})},processData(a){const t={dates:[],learningPass:[],learningFail:[],reviewPass:[],reviewFail:[]},e={};return a.forEach(s=>{const i=new Date(s.timestamp).toLocaleDateString();e[i]||(e[i]={learningPass:0,learningFail:0,reviewPass:0,reviewFail:0}),s.type===h.LEARNING?s.status===o.PASS?e[i].learningPass++:e[i].learningFail++:s.status===o.PASS?e[i].reviewPass++:e[i].reviewFail++}),Object.keys(e).sort().forEach(s=>{t.dates.push(this.formatDate(s)),t.learningPass.push(e[s].learningPass),t.learningFail.push(e[s].learningFail),t.reviewPass.push(e[s].reviewPass),t.reviewFail.push(e[s].reviewFail)}),t},initChart(a){if(!this.$refs.chartContainer)return;this.chart=c(this.$refs.chartContainer);const t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){let s=e[0].axisValue+"<br/>";return e.forEach(i=>{const r=i.value;r>0&&(s+=`${i.marker} ${i.seriesName}: ${r}<br/>`)}),s}},legend:{data:["学习通过","学习失败","复习通过","复习失败"],top:0,textStyle:{fontSize:12}},grid:{left:"3%",right:"4%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"category",data:a.dates,axisLabel:{interval:0,rotate:45,fontSize:12}},yAxis:{type:"value",name:"数量",nameTextStyle:{fontSize:12},axisLabel:{fontSize:12}},series:[{name:"学习通过",type:"bar",stack:"total",data:a.learningPass,itemStyle:{color:"#91cc75"},emphasis:{focus:"series"}},{name:"学习失败",type:"bar",stack:"total",data:a.learningFail,itemStyle:{color:"#ee6666"},emphasis:{focus:"series"}},{name:"复习通过",type:"bar",stack:"total",data:a.reviewPass,itemStyle:{color:"#5470c6"},emphasis:{focus:"series"}},{name:"复习失败",type:"bar",stack:"total",data:a.reviewFail,itemStyle:{color:"#fac858"},emphasis:{focus:"series"}}]};this.chart.setOption(t),this.$refs.chartContainer.addEventListener("touchstart",this.handleTouchStart),this.$refs.chartContainer.addEventListener("touchmove",this.handleTouchMove)},handleTouchStart(a){this.touchStartX=a.touches[0].clientX,this.touchStartY=a.touches[0].clientY},handleTouchMove(a){if(!this.touchStartX||!this.touchStartY)return;const t=a.touches[0].clientX,e=a.touches[0].clientY,s=t-this.touchStartX,i=e-this.touchStartY;Math.abs(s)>Math.abs(i)&&a.preventDefault()},async loadData(){try{this.loading=!0,this.records=await n.getAllRecords(),this.filterRecords();const a=this.processData(this.filteredRecords);this.loading=!1,await this.$nextTick(()=>{}),this.initChart(a)}catch(a){console.error("加载数据失败:",a)}finally{this.loading=!1}},async generateTestData(){try{this.loading=!0,await n.generateTestData(),await this.loadData()}catch(a){console.error("生成测试数据失败:",a)}finally{this.loading=!1}},handleResize(){this.chart&&this.chart.resize()}},mounted(){this.loadData(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.$refs.chartContainer&&(this.$refs.chartContainer.removeEventListener("touchstart",this.handleTouchStart),this.$refs.chartContainer.removeEventListener("touchmove",this.handleTouchMove)),this.chart&&this.chart.dispose()}};var f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"record-view"},[e("div",{staticClass:"date-range-picker"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedRange,expression:"selectedRange"}],on:{change:[function(s){var i=Array.prototype.filter.call(s.target.options,function(r){return r.selected}).map(function(r){var l="_value"in r?r._value:r.value;return l});t.selectedRange=s.target.multiple?i:i[0]},t.handleRangeChange]}},[e("option",{attrs:{value:"7"}},[t._v("最近7天")]),e("option",{attrs:{value:"14"}},[t._v("最近14天")]),e("option",{attrs:{value:"30"}},[t._v("最近30天")]),e("option",{attrs:{value:"90"}},[t._v("最近90天")]),e("option",{attrs:{value:"all"}},[t._v("全部")])])]),t.loading?e("div",{staticClass:"loading"},[e("div",{staticClass:"loading-spinner"}),e("span",[t._v("加载中...")])]):t.hasData?e("div",{ref:"chartContainer",staticClass:"chart-container"}):e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[t._v("📊")]),e("p",[t._v("暂无学习记录")]),e("p",{staticClass:"empty-tip"},[t._v("开始学习单词后，这里会显示您的学习进度")]),t.isDebugMode?e("button",{staticClass:"generate-btn",on:{click:t.generateTestData}},[t._v(" 生成测试数据 ")]):t._e()])])},p=[],g=d(v,f,p,!1,null,"89e150e9");const y=g.exports;export{y as default};
