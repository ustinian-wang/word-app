import{V as h}from"./vendor-C-Ryi81X.js";import{n as o,k as w,o as g,y as b,p as _,f as C,m as x}from"./index-BqJ9MkEI.js";import{w as m}from"./WordRecordDB-ZKtcZKYU.js";import{w as d}from"./WordReviewDB-Dwf42sz8.js";import{$ as n}from"./toast-CEWDI-I-.js";import"./utils-DttJ4vl2.js";const y={name:"WaModal",props:{visible:Boolean,title:String,content:String,confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},width:{type:String,default:"260px"}},methods:{handleConfirm(){this.$emit("confirm")},onCancel(){this.$emit("update:visible",!1)}}};var $=function(){var e=this,s=e._self._c;return s("transition",{attrs:{name:"modal-fade"}},[e.visible?s("div",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-overlay",expression:"'wa-modal-overlay'"}],staticClass:"wa-modal-overlay",on:{click:function(a){return a.target!==a.currentTarget?null:e.$emit("update:visible",!1)}}},[s("div",{staticClass:"wa-modal",style:{width:e.width}},[e.title?s("div",{staticClass:"wa-modal-header"},[e._v(" "+e._s(e.title)+" "),s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-close",expression:"'wa-modal-close'"}],staticClass:"wa-modal-close",on:{click:function(a){return e.$emit("update:visible",!1)}}},[e._v("×")])]):e._e(),s("div",{staticClass:"wa-modal-body"},[e._t("default")],2),s("div",{staticClass:"wa-modal-footer"},[s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-cancel",expression:"'wa-modal-cancel'"}],staticClass:"wa-button-cancel",on:{click:function(a){return e.$emit("update:visible",!1)}}},[e._v("取消")]),s("button",{directives:[{name:"test",rawName:"v-test",value:"wa-modal-confirm",expression:"'wa-modal-confirm'"}],staticClass:"wa-button-confirm",on:{click:e.handleConfirm}},[e._v("确认")])])])]):e._e()])},N=[],D=o(y,$,N,!1,null,"269d53bb");const p=D.exports;let i=null;function S(t){return k({content:t,confirmText:"确认",cancelText:"取消"})}function k({title:t="",content:e="",confirmText:s="确认",cancelText:a="取消"}={}){return new Promise(c=>{const f=h.extend(p);i=new f({propsData:{visible:!0,title:t,content:e,confirmText:s,cancelText:a}}),i.$mount(),document.body.appendChild(i.$el);const u=()=>{i&&(i.$destroy(),i.$el&&i.$el.parentNode&&i.$el.parentNode.removeChild(i.$el),i=null)};i.$on("confirm",()=>{u(),c(!0)}),i.$on("cancel",()=>{u(),c(!1)})})}async function R(){try{if(await S("确定要清理缓存吗？"))return;if(localStorage.clear(),sessionStorage.clear(),(await window.indexedDB.databases()).forEach(e=>{e.name&&window.indexedDB.deleteDatabase(e.name)}),"caches"in window){const e=await caches.keys();await Promise.all(e.map(s=>caches.delete(s)))}window.word_cache&&(window.word_cache={}),this.$message.success("缓存清理成功，页面将在3秒后刷新"),await w(300)}catch(t){console.error("清理缓存失败:",t),this.$message.error("清理缓存失败，请重试")}finally{window.location.reload(!0)}}const B={name:"WaInputNumber",props:{value:{type:[Number,String],default:0},min:{type:Number,default:-1/0},max:{type:Number,default:1/0},step:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data(){return{currValue:this.value||0}},watch:{value(t){this.currValue=t}},methods:{onInput(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[input]",e),this.$emit("input",e)},onChange(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[change]",e),this.$emit("change",e)},increment(){if(this.disabled)return;let t=this.value+this.step;t>this.max&&(t=this.max),console.log("[increment]",t),this.$emit("input",t),this.$emit("change",t)},decrement(){if(this.disabled)return;let t=this.value-this.step;t<this.min&&(t=this.min),console.log("[decrement]",t),this.$emit("input",t),this.$emit("change",t)},onBlur(t){let e=Number(t.target.value);isNaN(e)&&(e=this.min),e<this.min&&(e=this.min),e>this.max&&(e=this.max),console.log("[blur]",e),this.$emit("input",e),this.$emit("change",e)}}};var z=function(){var e=this,s=e._self._c;return s("div",{staticClass:"wa-input-number",class:{"wa-input-number--disabled":e.disabled}},[s("button",{staticClass:"wa-btn wa-btn-minus",attrs:{disabled:e.disabled||e.value<=e.min},on:{click:e.decrement}},[e._v(" - ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.currValue,expression:"currValue"}],staticClass:"wa-input",attrs:{min:e.min,max:e.max,step:e.step,disabled:e.disabled},domProps:{value:e.currValue},on:{change:e.onChange,blur:e.onBlur,input:function(a){a.target.composing||(e.currValue=a.target.value)}}}),s("button",{staticClass:"wa-btn wa-btn-plus",attrs:{disabled:e.disabled||e.value>=e.max},on:{click:e.increment}},[e._v(" + ")])])},I=[],V=o(B,z,I,!1,null,"9ddaa594");const A=V.exports,M={name:"WaSwitch",props:{modelValue:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},methods:{onChange(t){const e=t.target.checked;this.$emit("update:modelValue",e),this.$emit("input",e),this.$emit("change",e)}}};var W=function(){var e=this,s=e._self._c;return s("label",{staticClass:"wa-switch",class:{"wa-switch--disabled":e.disabled}},[s("input",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-input",expression:"'wa-switch-input'"}],attrs:{type:"checkbox",disabled:e.disabled},domProps:{checked:e.modelValue},on:{change:e.onChange}}),s("span",{staticClass:"wa-slider"})])},G=[],P=o(M,W,G,!1,null,"6d5ee8b6");const E=P.exports;function v(t=""){return{success:!0,msg:t,rt:0}}function r(t=""){return{success:!1,msg:t,rt:0}}function F(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}async function T(){const t=await m.getAllRecords(),e=await d.getAllWords();let s={wordRecords:t,wordReviews:e};if(console.log(s),l(s))return r("没有需要导出的学习记录。");const a=JSON.stringify(s);return F(a),v("学习记录已成功导出到剪贴板！")}function l(t){let{wordRecords:e=[],wordReviews:s=[]}=t;return console.log(e,s),e.length===0&&s.length===0}async function O(t){if(console.log("[importAppData2DB] 111",t),g(t)){if(t=t.trim(),console.log("[importAppData2DB] 222",t),t==="")return r("粘贴内容不能为空！");b(t)&&(t=JSON.parse(t),console.log("[importAppData2DB] 333",t))}if(_(t)){if(console.log("[importAppData2DB] 444",t),l(t))return r("没有需要导入的学习记录。")}else return r("粘贴内容格式错误！");let{wordRecords:e=[],wordReviews:s=[]}=t;if(l(t))return r("没有需要导入的学习记录。");for(const a of e)await m.importRecord(a);for(const a of s)await d.importWord(a);return v("导入成功！")}const q={name:"Settings",components:{WaInputNumber:A,WaSwitch:E,WaModal:p},data(){return{theme:"light",showPhonetic:!0,autoPlayAudio:!1,showDictionary:!0,enableShortcuts:!0,showImportModal:!1,importData:""}},computed:{...x("setting",["groupSize","debug","debugSetup"]),...C("setting",["setGroupSize","setDebug"]),currGroupSize:{get(){return this.groupSize},set(t){console.log("[value]",t),this.setGroupSize(t)}},currDebug:{get(){return this.debug},set(t){this.setDebug(t)}}},methods:{clearSysCache:R,saveSettings(){alert("设置已保存（仅本地演示，未持久化）")},async handleExport(){let t=await T();t.success?n.success("导出成功"):n.error(t.msg||"导出失败")},async handleImport(){if(!this.importData){n.error("请输入导入内容");return}let t=await O(this.importData);t.success?(n.success("导入成功"),this.showImportModal=!1,this.importData=""):n.error(t.msg||"导入失败")},openFeedback(){window.open("https://support.qq.com/product/741648","_blank")}}};var J=function(){var e=this,s=e._self._c;return s("div",{staticClass:"settings-page"},[s("div",{staticClass:"settings-group"},[s("div",{staticClass:"settings-title"},[e._v("通用")]),e.debugSetup?s("div",{staticClass:"setting-item"},[s("span",{staticClass:"setting-label"},[e._v("调试模式")]),s("wa-switch",{directives:[{name:"test",rawName:"v-test",value:"wa-switch-debug",expression:"'wa-switch-debug'"}],model:{value:e.currDebug,callback:function(a){e.currDebug=a},expression:"currDebug"}})],1):e._e(),s("div",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],staticClass:"setting-item"},[s("span",{staticClass:"setting-label"},[e._v("主单词字号")]),s("div",{staticClass:"setting-control"},[s("wa-input-number",{directives:[{name:"test",rawName:"v-test",value:"setting-group-size",expression:"'setting-group-size'"}],attrs:{min:10,max:40,step:1},model:{value:e.currGroupSize,callback:function(a){e.currGroupSize=a},expression:"currGroupSize"}})],1)]),s("div",{directives:[{name:"test",rawName:"v-test",value:"clearCache",expression:"'clearCache'"}],staticClass:"setting-item",on:{click:e.clearSysCache}},[s("span",{staticClass:"setting-label",staticStyle:{color:"#3578e5"}},[e._v("清理缓存")])])]),s("div",{staticClass:"settings-group"},[s("div",{staticClass:"settings-title"},[e._v("数据同步")]),s("div",{staticClass:"setting-item"},[s("span",{staticClass:"setting-label"},[e._v("学习记录")]),s("div",{staticClass:"setting-actions"},[s("button",{directives:[{name:"test",rawName:"v-test",value:"export",expression:"'export'"}],staticClass:"wa-button",attrs:{type:"button"},on:{click:e.handleExport}},[e._v(" 导出 ")]),s("button",{directives:[{name:"test",rawName:"v-test",value:"import",expression:"'import'"}],staticClass:"wa-button",attrs:{type:"button"},on:{click:function(a){e.showImportModal=!0}}},[e._v(" 导入 ")])])])]),s("div",{staticClass:"settings-footer"},[e._v("更多设置即将开放…")]),s("div",{staticClass:"settings-feedback"},[s("button",{staticClass:"wa-button",attrs:{type:"button"},on:{click:e.openFeedback}},[e._v("意见反馈")])]),s("wa-modal",{attrs:{visible:e.showImportModal,title:"导入学习记录"},on:{"update:visible":function(a){e.showImportModal=a},confirm:e.handleImport}},[s("p",{staticClass:"import-description"},[e._v("请将之前导出的学习记录文本粘贴到下方文本框中。")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.importData,expression:"importData"},{name:"test",rawName:"v-test",value:"import-textarea",expression:"'import-textarea'"}],staticClass:"import-textarea",attrs:{placeholder:"请在此处粘贴学习记录..."},domProps:{value:e.importData},on:{input:function(a){a.target.composing||(e.importData=a.target.value)}}})])],1)},j=[],H=o(q,J,j,!1,null,"dff76d44");const Z=H.exports;export{Z as default};
